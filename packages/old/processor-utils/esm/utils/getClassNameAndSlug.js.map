{"version":3,"file":"getClassNameAndSlug.js","names":["basename","dirname","extname","relative","sep","posix","logger","slugify","buildSlug","toValidCSSIdentifier","getClassNameAndSlug","displayName","idx","options","context","console","log","relativeFilename","root","filename","replace","slug","charAt","toLowerCase","ext","slugVars","hash","title","index","file","name","dir","split","pop","className","classNameSlug","Error","extend"],"sources":["../../src/utils/getClassNameAndSlug.ts"],"sourcesContent":["import { basename, dirname, extname, relative, sep, posix } from 'path';\n\nimport type { ClassNameSlugVars } from '@wyw-in-js/shared';\nimport { logger, slugify } from '@wyw-in-js/shared';\n\nimport { buildSlug } from './buildSlug';\nimport { toValidCSSIdentifier } from './toValidCSSIdentifier';\nimport type { IFileContext, IOptions } from './types';\n\nexport default function getClassNameAndSlug(\n  displayName: string,\n  idx: number,\n  options: IOptions,\n  context: IFileContext\n): { className: string; slug: string } {\n  console.log(\"getClassNameAndSlug.ts - getClassNameAndSlug\");\n  const relativeFilename = (\n    context.root && context.filename\n      ? relative(context.root, context.filename)\n      : context.filename ?? 'unknown'\n  ).replace(/\\\\/g, posix.sep);\n\n  // Custom properties need to start with a letter, so we prefix the slug\n  // Also use append the index of the class to the filename for uniqueness in the file\n  const slug = toValidCSSIdentifier(\n    `${displayName.charAt(0).toLowerCase()}${slugify(\n      `${relativeFilename}:${idx}`\n    )}`\n  );\n\n  // Collect some useful replacement patterns from the filename\n  // Available variables for the square brackets used in `classNameSlug` options\n  const ext = extname(relativeFilename);\n  const slugVars: ClassNameSlugVars = {\n    hash: slug,\n    title: displayName,\n    index: idx,\n    file: relativeFilename,\n    ext,\n    name: basename(relativeFilename, ext),\n    dir: dirname(relativeFilename).split(sep).pop() as string,\n  };\n\n  let className = options.displayName\n    ? `${toValidCSSIdentifier(displayName!)}_${slug!}`\n    : slug!;\n\n  // The className can be defined by the user either as fn or a string\n  if (typeof options.classNameSlug === 'function') {\n    try {\n      className = toValidCSSIdentifier(\n        options.classNameSlug(slug, displayName, slugVars)\n      );\n    } catch {\n      throw new Error('classNameSlug option must return a string');\n    }\n  }\n\n  if (typeof options.classNameSlug === 'string') {\n    className = toValidCSSIdentifier(\n      buildSlug(options.classNameSlug, slugVars)\n    );\n  }\n\n  logger.extend('template-parse:generated-meta')(\n    `slug: ${slug}, displayName: ${displayName}, className: ${className}`\n  );\n\n  return { className, slug };\n}\n"],"mappings":"AAAA,SAASA,QAAQ,EAAEC,OAAO,EAAEC,OAAO,EAAEC,QAAQ,EAAEC,GAAG,EAAEC,KAAK,QAAQ,MAAM;AAGvE,SAASC,MAAM,EAAEC,OAAO,QAAQ,mBAAmB;AAEnD,SAASC,SAAS,QAAQ,aAAa;AACvC,SAASC,oBAAoB,QAAQ,wBAAwB;AAG7D,eAAe,SAASC,mBAAmBA,CACzCC,WAAmB,EACnBC,GAAW,EACXC,OAAiB,EACjBC,OAAqB,EACgB;EACrCC,OAAO,CAACC,GAAG,CAAC,8CAA8C,CAAC;EAC3D,MAAMC,gBAAgB,GAAG,CACvBH,OAAO,CAACI,IAAI,IAAIJ,OAAO,CAACK,QAAQ,GAC5BhB,QAAQ,CAACW,OAAO,CAACI,IAAI,EAAEJ,OAAO,CAACK,QAAQ,CAAC,GACxCL,OAAO,CAACK,QAAQ,IAAI,SAAS,EACjCC,OAAO,CAAC,KAAK,EAAEf,KAAK,CAACD,GAAG,CAAC;;EAE3B;EACA;EACA,MAAMiB,IAAI,GAAGZ,oBAAoB,CAC9B,GAAEE,WAAW,CAACW,MAAM,CAAC,CAAC,CAAC,CAACC,WAAW,CAAC,CAAE,GAAEhB,OAAO,CAC7C,GAAEU,gBAAiB,IAAGL,GAAI,EAC7B,CAAE,EACJ,CAAC;;EAED;EACA;EACA,MAAMY,GAAG,GAAGtB,OAAO,CAACe,gBAAgB,CAAC;EACrC,MAAMQ,QAA2B,GAAG;IAClCC,IAAI,EAAEL,IAAI;IACVM,KAAK,EAAEhB,WAAW;IAClBiB,KAAK,EAAEhB,GAAG;IACViB,IAAI,EAAEZ,gBAAgB;IACtBO,GAAG;IACHM,IAAI,EAAE9B,QAAQ,CAACiB,gBAAgB,EAAEO,GAAG,CAAC;IACrCO,GAAG,EAAE9B,OAAO,CAACgB,gBAAgB,CAAC,CAACe,KAAK,CAAC5B,GAAG,CAAC,CAAC6B,GAAG,CAAC;EAChD,CAAC;EAED,IAAIC,SAAS,GAAGrB,OAAO,CAACF,WAAW,GAC9B,GAAEF,oBAAoB,CAACE,WAAY,CAAE,IAAGU,IAAM,EAAC,GAChDA,IAAK;;EAET;EACA,IAAI,OAAOR,OAAO,CAACsB,aAAa,KAAK,UAAU,EAAE;IAC/C,IAAI;MACFD,SAAS,GAAGzB,oBAAoB,CAC9BI,OAAO,CAACsB,aAAa,CAACd,IAAI,EAAEV,WAAW,EAAEc,QAAQ,CACnD,CAAC;IACH,CAAC,CAAC,MAAM;MACN,MAAM,IAAIW,KAAK,CAAC,2CAA2C,CAAC;IAC9D;EACF;EAEA,IAAI,OAAOvB,OAAO,CAACsB,aAAa,KAAK,QAAQ,EAAE;IAC7CD,SAAS,GAAGzB,oBAAoB,CAC9BD,SAAS,CAACK,OAAO,CAACsB,aAAa,EAAEV,QAAQ,CAC3C,CAAC;EACH;EAEAnB,MAAM,CAAC+B,MAAM,CAAC,+BAA+B,CAAC,CAC3C,SAAQhB,IAAK,kBAAiBV,WAAY,gBAAeuB,SAAU,EACtE,CAAC;EAED,OAAO;IAAEA,SAAS;IAAEb;EAAK,CAAC;AAC5B","ignoreList":[]}