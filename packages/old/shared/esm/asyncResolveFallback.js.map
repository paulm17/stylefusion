{"version":3,"file":"asyncResolveFallback.js","names":["path","safeResolve","name","where","console","log","require","resolve","paths","e","suffixes","reduce","acc","ext","push","syncResolve","what","importer","stack","map","p","dirname","resolved","Error","suffix","resolvedWithSuffix","asyncResolveFallback","Promise"],"sources":["../src/asyncResolveFallback.ts"],"sourcesContent":["import path from 'path';\n\nconst safeResolve = (name: string, where: string[]): string | Error => {\n  console.log(\"asyncResolveFallback.ts - safeResolve\");\n  try {\n    return require.resolve(name, {\n      paths: where,\n    });\n  } catch (e: unknown) {\n    return e as Error;\n  }\n};\n\nconst suffixes = ['.js', '.ts', '.jsx', '.tsx'].reduce((acc: string[], ext) => {\n  console.log(\"asyncResolveFallback.ts - suffixes\");\n  acc.push(`/index${ext}`);\n  acc.push(ext);\n  return acc;\n}, []);\n\nexport const syncResolve = (\n  what: string,\n  importer: string,\n  stack: string[]\n): string => {\n  console.log(\"asyncResolveFallback.ts - syncResolve\");\n  const where = [importer, ...stack].map((p) => path.dirname(p));\n  const resolved = safeResolve(what, where);\n  if (!(resolved instanceof Error)) {\n    return resolved;\n  }\n\n  // eslint-disable-next-line no-restricted-syntax\n  for (const suffix of suffixes) {\n    const resolvedWithSuffix = safeResolve(what + suffix, where);\n    if (resolvedWithSuffix instanceof Error) {\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    return resolvedWithSuffix;\n  }\n\n  throw resolved;\n};\n\nexport const asyncResolveFallback = (\n  what: string,\n  importer: string,\n  stack: string[]\n): Promise<string> => {\n  console.log(\"asyncResolveFallback.ts - asyncResolveFallback\");\n  const resolved = syncResolve(what, importer, stack);\n  return Promise.resolve(resolved);\n};\n"],"mappings":"AAAA,OAAOA,IAAI,MAAM,MAAM;AAEvB,MAAMC,WAAW,GAAGA,CAACC,IAAY,EAAEC,KAAe,KAAqB;EACrEC,OAAO,CAACC,GAAG,CAAC,uCAAuC,CAAC;EACpD,IAAI;IACF,OAAOC,OAAO,CAACC,OAAO,CAACL,IAAI,EAAE;MAC3BM,KAAK,EAAEL;IACT,CAAC,CAAC;EACJ,CAAC,CAAC,OAAOM,CAAU,EAAE;IACnB,OAAOA,CAAC;EACV;AACF,CAAC;AAED,MAAMC,QAAQ,GAAG,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE,MAAM,CAAC,CAACC,MAAM,CAAC,CAACC,GAAa,EAAEC,GAAG,KAAK;EAC7ET,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAC;EACjDO,GAAG,CAACE,IAAI,CAAE,SAAQD,GAAI,EAAC,CAAC;EACxBD,GAAG,CAACE,IAAI,CAACD,GAAG,CAAC;EACb,OAAOD,GAAG;AACZ,CAAC,EAAE,EAAE,CAAC;AAEN,OAAO,MAAMG,WAAW,GAAGA,CACzBC,IAAY,EACZC,QAAgB,EAChBC,KAAe,KACJ;EACXd,OAAO,CAACC,GAAG,CAAC,uCAAuC,CAAC;EACpD,MAAMF,KAAK,GAAG,CAACc,QAAQ,EAAE,GAAGC,KAAK,CAAC,CAACC,GAAG,CAAEC,CAAC,IAAKpB,IAAI,CAACqB,OAAO,CAACD,CAAC,CAAC,CAAC;EAC9D,MAAME,QAAQ,GAAGrB,WAAW,CAACe,IAAI,EAAEb,KAAK,CAAC;EACzC,IAAI,EAAEmB,QAAQ,YAAYC,KAAK,CAAC,EAAE;IAChC,OAAOD,QAAQ;EACjB;;EAEA;EACA,KAAK,MAAME,MAAM,IAAId,QAAQ,EAAE;IAC7B,MAAMe,kBAAkB,GAAGxB,WAAW,CAACe,IAAI,GAAGQ,MAAM,EAAErB,KAAK,CAAC;IAC5D,IAAIsB,kBAAkB,YAAYF,KAAK,EAAE;MACvC;MACA;IACF;IAEA,OAAOE,kBAAkB;EAC3B;EAEA,MAAMH,QAAQ;AAChB,CAAC;AAED,OAAO,MAAMI,oBAAoB,GAAGA,CAClCV,IAAY,EACZC,QAAgB,EAChBC,KAAe,KACK;EACpBd,OAAO,CAACC,GAAG,CAAC,gDAAgD,CAAC;EAC7D,MAAMiB,QAAQ,GAAGP,WAAW,CAACC,IAAI,EAAEC,QAAQ,EAAEC,KAAK,CAAC;EACnD,OAAOS,OAAO,CAACpB,OAAO,CAACe,QAAQ,CAAC;AAClC,CAAC","ignoreList":[]}