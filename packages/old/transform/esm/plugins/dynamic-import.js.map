{"version":3,"file":"dynamic-import.js","names":["dynamicImport","babel","console","log","types","t","name","visitor","CallExpression","path","get","isImport","moduleName","isStringLiteral","replaceWith","callExpression","identifier","stringLiteral","node","value","isTemplateLiteral","cloneNode","Error"],"sources":["../../src/plugins/dynamic-import.ts"],"sourcesContent":["import type { NodePath, PluginObj } from '@babel/core';\n\nimport type { Core } from '../babel';\n\n/**\n * The plugin that replaces `import()` with `__wyw_dynamic_import` as Node VM does not support dynamic imports yet.\n */\nexport default function dynamicImport(babel: Core): PluginObj {\n  console.log(\"dynamic-import - dynamicImport\");\n  const { types: t } = babel;\n\n  return {\n    name: '@wyw-in-js/transform/dynamic-import',\n    visitor: {\n      CallExpression(path) {\n        if (path.get('callee').isImport()) {\n          const moduleName = path.get('arguments.0') as NodePath;\n\n          if (moduleName.isStringLiteral()) {\n            path.replaceWith(\n              t.callExpression(t.identifier('__wyw_dynamic_import'), [\n                t.stringLiteral(moduleName.node.value),\n              ])\n            );\n            return;\n          }\n\n          if (moduleName.isTemplateLiteral()) {\n            path.replaceWith(\n              t.callExpression(t.identifier('__wyw_dynamic_import'), [\n                t.cloneNode(moduleName.node, true, true),\n              ])\n            );\n            return;\n          }\n\n          throw new Error(\n            'Dynamic import argument must be a string or a template literal'\n          );\n        }\n      },\n    },\n  };\n}\n"],"mappings":"AAIA;AACA;AACA;AACA,eAAe,SAASA,aAAaA,CAACC,KAAW,EAAa;EAC5DC,OAAO,CAACC,GAAG,CAAC,gCAAgC,CAAC;EAC7C,MAAM;IAAEC,KAAK,EAAEC;EAAE,CAAC,GAAGJ,KAAK;EAE1B,OAAO;IACLK,IAAI,EAAE,qCAAqC;IAC3CC,OAAO,EAAE;MACPC,cAAcA,CAACC,IAAI,EAAE;QACnB,IAAIA,IAAI,CAACC,GAAG,CAAC,QAAQ,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAE;UACjC,MAAMC,UAAU,GAAGH,IAAI,CAACC,GAAG,CAAC,aAAa,CAAa;UAEtD,IAAIE,UAAU,CAACC,eAAe,CAAC,CAAC,EAAE;YAChCJ,IAAI,CAACK,WAAW,CACdT,CAAC,CAACU,cAAc,CAACV,CAAC,CAACW,UAAU,CAAC,sBAAsB,CAAC,EAAE,CACrDX,CAAC,CAACY,aAAa,CAACL,UAAU,CAACM,IAAI,CAACC,KAAK,CAAC,CACvC,CACH,CAAC;YACD;UACF;UAEA,IAAIP,UAAU,CAACQ,iBAAiB,CAAC,CAAC,EAAE;YAClCX,IAAI,CAACK,WAAW,CACdT,CAAC,CAACU,cAAc,CAACV,CAAC,CAACW,UAAU,CAAC,sBAAsB,CAAC,EAAE,CACrDX,CAAC,CAACgB,SAAS,CAACT,UAAU,CAACM,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,CACzC,CACH,CAAC;YACD;UACF;UAEA,MAAM,IAAII,KAAK,CACb,gEACF,CAAC;QACH;MACF;IACF;EACF,CAAC;AACH","ignoreList":[]}