{"version":3,"file":"addIdentifierToWywPreval.js","names":["createId","reference","getOrAddWywPreval","scope","console","log","rootScope","getProgramParent","programPath","path","object","getData","node","sourceType","prevalExport","expression","type","operator","left","computed","property","right","properties","inserted","pushContainer","get","declaration","declarations","id","init","kind","specifiers","setData","addIdentifierToWywPreval","name","newProperty","key","value","shorthand"],"sources":["../../src/utils/addIdentifierToWywPreval.ts"],"sourcesContent":["import type { NodePath, Scope } from '@babel/traverse';\nimport type {\n  ExportNamedDeclaration,\n  ExpressionStatement,\n  Identifier,\n  ObjectExpression,\n  ObjectProperty,\n  Program,\n} from '@babel/types';\n\nimport { createId } from './createId';\nimport { reference } from './scopeHelpers';\n\nexport function getOrAddWywPreval(scope: Scope): NodePath<ObjectExpression> {\n  console.log(\"addIdentifierToWywPreval - getOrAddWywPreval\");\n  const rootScope = scope.getProgramParent();\n  const programPath = rootScope.path as NodePath<Program>;\n\n  let object = programPath.getData('__wywPreval');\n  if (object) {\n    return object;\n  }\n\n  if (programPath.node.sourceType === 'script') {\n    // CJS exports.__wywPreval = {};\n    const prevalExport: ExpressionStatement = {\n      expression: {\n        type: 'AssignmentExpression',\n        operator: '=',\n        left: {\n          computed: false,\n          object: createId('exports'),\n          property: createId('__wywPreval'),\n          type: 'MemberExpression',\n        },\n        right: {\n          properties: [],\n          type: 'ObjectExpression',\n        },\n      },\n      type: 'ExpressionStatement',\n    };\n\n    const [inserted] = programPath.pushContainer('body', [prevalExport]);\n    object = inserted.get('expression.right') as NodePath<ObjectExpression>;\n  } else {\n    // ESM export const __wywPreval = {};\n    const prevalExport: ExportNamedDeclaration = {\n      declaration: {\n        declarations: [\n          {\n            id: createId('__wywPreval'),\n            init: {\n              properties: [],\n              type: 'ObjectExpression',\n            },\n            type: 'VariableDeclarator',\n          },\n        ],\n        kind: 'const',\n        type: 'VariableDeclaration',\n      },\n      specifiers: [],\n      type: 'ExportNamedDeclaration',\n    };\n\n    const [inserted] = programPath.pushContainer('body', [prevalExport]);\n    object = inserted.get(\n      'declaration.declarations.0.init'\n    ) as NodePath<ObjectExpression>;\n  }\n\n  programPath.setData('__wywPreval', object);\n  return object;\n}\n\nexport function addIdentifierToWywPreval(scope: Scope, name: string) {\n  console.log(\"addIdentifierToWywPreval - addIdentifierToWywPreval\");\n  const rootScope = scope.getProgramParent();\n  const object = getOrAddWywPreval(rootScope);\n  const newProperty: ObjectProperty = {\n    type: 'ObjectProperty',\n    key: createId(name),\n    value: createId(name),\n    computed: false,\n    shorthand: false,\n  };\n\n  const [inserted] = object.pushContainer('properties', [newProperty]);\n  reference(inserted.get('value') as NodePath<Identifier>);\n}\n"],"mappings":"AAUA,SAASA,QAAQ,QAAQ,YAAY;AACrC,SAASC,SAAS,QAAQ,gBAAgB;AAE1C,OAAO,SAASC,iBAAiBA,CAACC,KAAY,EAA8B;EAC1EC,OAAO,CAACC,GAAG,CAAC,8CAA8C,CAAC;EAC3D,MAAMC,SAAS,GAAGH,KAAK,CAACI,gBAAgB,CAAC,CAAC;EAC1C,MAAMC,WAAW,GAAGF,SAAS,CAACG,IAAyB;EAEvD,IAAIC,MAAM,GAAGF,WAAW,CAACG,OAAO,CAAC,aAAa,CAAC;EAC/C,IAAID,MAAM,EAAE;IACV,OAAOA,MAAM;EACf;EAEA,IAAIF,WAAW,CAACI,IAAI,CAACC,UAAU,KAAK,QAAQ,EAAE;IAC5C;IACA,MAAMC,YAAiC,GAAG;MACxCC,UAAU,EAAE;QACVC,IAAI,EAAE,sBAAsB;QAC5BC,QAAQ,EAAE,GAAG;QACbC,IAAI,EAAE;UACJC,QAAQ,EAAE,KAAK;UACfT,MAAM,EAAEV,QAAQ,CAAC,SAAS,CAAC;UAC3BoB,QAAQ,EAAEpB,QAAQ,CAAC,aAAa,CAAC;UACjCgB,IAAI,EAAE;QACR,CAAC;QACDK,KAAK,EAAE;UACLC,UAAU,EAAE,EAAE;UACdN,IAAI,EAAE;QACR;MACF,CAAC;MACDA,IAAI,EAAE;IACR,CAAC;IAED,MAAM,CAACO,QAAQ,CAAC,GAAGf,WAAW,CAACgB,aAAa,CAAC,MAAM,EAAE,CAACV,YAAY,CAAC,CAAC;IACpEJ,MAAM,GAAGa,QAAQ,CAACE,GAAG,CAAC,kBAAkB,CAA+B;EACzE,CAAC,MAAM;IACL;IACA,MAAMX,YAAoC,GAAG;MAC3CY,WAAW,EAAE;QACXC,YAAY,EAAE,CACZ;UACEC,EAAE,EAAE5B,QAAQ,CAAC,aAAa,CAAC;UAC3B6B,IAAI,EAAE;YACJP,UAAU,EAAE,EAAE;YACdN,IAAI,EAAE;UACR,CAAC;UACDA,IAAI,EAAE;QACR,CAAC,CACF;QACDc,IAAI,EAAE,OAAO;QACbd,IAAI,EAAE;MACR,CAAC;MACDe,UAAU,EAAE,EAAE;MACdf,IAAI,EAAE;IACR,CAAC;IAED,MAAM,CAACO,QAAQ,CAAC,GAAGf,WAAW,CAACgB,aAAa,CAAC,MAAM,EAAE,CAACV,YAAY,CAAC,CAAC;IACpEJ,MAAM,GAAGa,QAAQ,CAACE,GAAG,CACnB,iCACF,CAA+B;EACjC;EAEAjB,WAAW,CAACwB,OAAO,CAAC,aAAa,EAAEtB,MAAM,CAAC;EAC1C,OAAOA,MAAM;AACf;AAEA,OAAO,SAASuB,wBAAwBA,CAAC9B,KAAY,EAAE+B,IAAY,EAAE;EACnE9B,OAAO,CAACC,GAAG,CAAC,qDAAqD,CAAC;EAClE,MAAMC,SAAS,GAAGH,KAAK,CAACI,gBAAgB,CAAC,CAAC;EAC1C,MAAMG,MAAM,GAAGR,iBAAiB,CAACI,SAAS,CAAC;EAC3C,MAAM6B,WAA2B,GAAG;IAClCnB,IAAI,EAAE,gBAAgB;IACtBoB,GAAG,EAAEpC,QAAQ,CAACkC,IAAI,CAAC;IACnBG,KAAK,EAAErC,QAAQ,CAACkC,IAAI,CAAC;IACrBf,QAAQ,EAAE,KAAK;IACfmB,SAAS,EAAE;EACb,CAAC;EAED,MAAM,CAACf,QAAQ,CAAC,GAAGb,MAAM,CAACc,aAAa,CAAC,YAAY,EAAE,CAACW,WAAW,CAAC,CAAC;EACpElC,SAAS,CAACsB,QAAQ,CAACE,GAAG,CAAC,OAAO,CAAyB,CAAC;AAC1D","ignoreList":[]}