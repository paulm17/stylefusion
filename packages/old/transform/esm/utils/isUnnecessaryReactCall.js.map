{"version":3,"file":"isUnnecessaryReactCall.js","names":["collectExportsAndImports","getScope","getCallee","p","console","log","callee","get","isSequenceExpression","expressions","length","isNumericLiteral","value","JSXRuntimeSource","isJSXRuntime","imports","jsxRuntime","find","i","source","jsxRuntimeName","local","isIdentifier","node","name","isMemberExpression","isHookOrCreateElement","test","isClassicReactRuntime","reactImports","filter","imported","bindingPath","getBinding","path","some","isAncestor","object","property","defaultImport","isUnnecessaryReactCall","programPath","findParent","isProgram"],"sources":["../../src/utils/isUnnecessaryReactCall.ts"],"sourcesContent":["import type { NodePath } from '@babel/core';\nimport type { CallExpression, Program } from '@babel/types';\n\nimport type { IImport, ISideEffectImport } from './collectExportsAndImports';\nimport { collectExportsAndImports } from './collectExportsAndImports';\nimport { getScope } from './getScope';\n\nfunction getCallee(p: NodePath<CallExpression>) {\n  console.log(\"isUnnecessaryReactCall - getCallee\");\n  const callee = p.get('callee');\n  if (callee.isSequenceExpression()) {\n    const expressions = callee.get('expressions');\n    if (\n      expressions.length === 2 &&\n      expressions[0].isNumericLiteral({ value: 0 })\n    ) {\n      return expressions[1];\n    }\n\n    return callee;\n  }\n\n  return callee;\n}\n\nconst JSXRuntimeSource = 'react/jsx-runtime';\n\nfunction isJSXRuntime(\n  p: NodePath<CallExpression>,\n  imports: (IImport | ISideEffectImport)[]\n) {\n  const jsxRuntime = imports.find((i) => i.source === JSXRuntimeSource);\n  const jsxRuntimeName =\n    jsxRuntime?.local?.isIdentifier() && jsxRuntime?.local?.node?.name;\n\n  if (jsxRuntime) {\n    const callee = getCallee(p);\n    if (jsxRuntimeName && callee.isIdentifier({ name: jsxRuntimeName })) {\n      return true;\n    }\n\n    if (\n      callee.isMemberExpression() &&\n      imports.find((i) => i.source === JSXRuntimeSource && i.local === callee)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction isHookOrCreateElement(name: string): boolean {\n  console.log(\"isUnnecessaryReactCall - isHookOrCreateElement\");\n  return name === 'createElement' || /use[A-Z]/.test(name);\n}\n\nfunction isClassicReactRuntime(\n  p: NodePath<CallExpression>,\n  imports: (IImport | ISideEffectImport)[]\n) {\n  console.log(\"isUnnecessaryReactCall - isClassicReactRuntime\");\n  const reactImports = imports.filter(\n    (i) =>\n      i.source === 'react' &&\n      (i.imported === 'default' ||\n        (i.imported && isHookOrCreateElement(i.imported)))\n  ) as IImport[];\n\n  if (reactImports.length === 0) return false;\n  const callee = getCallee(p);\n  if (callee.isIdentifier() && isHookOrCreateElement(callee.node.name)) {\n    const bindingPath = getScope(callee).getBinding(callee.node.name)?.path;\n    return reactImports.some((i) => bindingPath?.isAncestor(i.local));\n  }\n\n  if (callee.isMemberExpression()) {\n    if (reactImports.some((i) => i.local === callee)) {\n      // It's React.createElement in CJS\n      return true;\n    }\n\n    const object = callee.get('object');\n    const property = callee.get('property');\n    const defaultImport = reactImports.find((i) => i.imported === 'default');\n    if (\n      !defaultImport ||\n      !defaultImport.local.isIdentifier() ||\n      !property.isIdentifier() ||\n      !isHookOrCreateElement(property.node.name) ||\n      !object.isIdentifier({ name: defaultImport.local.node.name })\n    ) {\n      return false;\n    }\n\n    const bindingPath = getScope(object).getBinding(object.node.name)?.path;\n    return bindingPath?.isAncestor(defaultImport.local) ?? false;\n  }\n\n  return false;\n}\n\nexport function isUnnecessaryReactCall(path: NodePath<CallExpression>) {\n  console.log(\"isUnnecessaryReactCall - isUnnecessaryReactCall\");\n  const programPath = path.findParent((p) => p.isProgram()) as\n    | NodePath<Program>\n    | undefined;\n  if (!programPath) {\n    return false;\n  }\n\n  const { imports } = collectExportsAndImports(programPath);\n\n  return isJSXRuntime(path, imports) || isClassicReactRuntime(path, imports);\n}\n"],"mappings":"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","ignoreList":[]}