{"version":3,"file":"loadBabelOptions.js","names":["cache","WeakMap","empty","loadBabelOptions","babel","filename","overrides","_cache$get","_babel$loadOptions","console","log","fileCache","get","Map","has","babelOptions","loadOptions","caller","name","supportsStaticESM","supportsDynamicImport","supportsTopLevelAwait","supportsExportNamespaceFrom","set"],"sources":["../../src/options/loadBabelOptions.ts"],"sourcesContent":["import type { TransformOptions } from '@babel/core';\n\nimport type { Core } from '../babel';\n\nconst cache = new WeakMap<\n  Partial<TransformOptions>,\n  Map<string, TransformOptions>\n>();\n\nconst empty = {};\n\nexport function loadBabelOptions(\n  babel: Core,\n  filename: string,\n  overrides: TransformOptions = empty\n) {\n  console.log(\"loadBabelOptions - loadBabelOptions\");\n  const fileCache = cache.get(overrides) ?? new Map<string, TransformOptions>();\n  if (fileCache.has(filename)) {\n    return fileCache.get(filename)!;\n  }\n\n  const babelOptions: TransformOptions =\n    babel.loadOptions({\n      ...overrides,\n      filename,\n      caller: {\n        name: 'wyw-in-js',\n\n        // Indicates for @babel/preset-env to support all ESM syntax and avoid transforms before it's needed\n        supportsStaticESM: true,\n        supportsDynamicImport: true,\n        supportsTopLevelAwait: true,\n        supportsExportNamespaceFrom: true,\n      },\n    }) ?? {};\n\n  fileCache.set(filename, babelOptions);\n  cache.set(overrides, fileCache);\n\n  return babelOptions;\n}\n"],"mappings":";;;;;;AAIA,MAAMA,KAAK,GAAG,IAAIC,OAAO,CAGvB,CAAC;AAEH,MAAMC,KAAK,GAAG,CAAC,CAAC;AAET,SAASC,gBAAgBA,CAC9BC,KAAW,EACXC,QAAgB,EAChBC,SAA2B,GAAGJ,KAAK,EACnC;EAAA,IAAAK,UAAA,EAAAC,kBAAA;EACAC,OAAO,CAACC,GAAG,CAAC,qCAAqC,CAAC;EAClD,MAAMC,SAAS,IAAAJ,UAAA,GAAGP,KAAK,CAACY,GAAG,CAACN,SAAS,CAAC,cAAAC,UAAA,cAAAA,UAAA,GAAI,IAAIM,GAAG,CAA2B,CAAC;EAC7E,IAAIF,SAAS,CAACG,GAAG,CAACT,QAAQ,CAAC,EAAE;IAC3B,OAAOM,SAAS,CAACC,GAAG,CAACP,QAAQ,CAAC;EAChC;EAEA,MAAMU,YAA8B,IAAAP,kBAAA,GAClCJ,KAAK,CAACY,WAAW,CAAC;IAChB,GAAGV,SAAS;IACZD,QAAQ;IACRY,MAAM,EAAE;MACNC,IAAI,EAAE,WAAW;MAEjB;MACAC,iBAAiB,EAAE,IAAI;MACvBC,qBAAqB,EAAE,IAAI;MAC3BC,qBAAqB,EAAE,IAAI;MAC3BC,2BAA2B,EAAE;IAC/B;EACF,CAAC,CAAC,cAAAd,kBAAA,cAAAA,kBAAA,GAAI,CAAC,CAAC;EAEVG,SAAS,CAACY,GAAG,CAAClB,QAAQ,EAAEU,YAAY,CAAC;EACrCf,KAAK,CAACuB,GAAG,CAACjB,SAAS,EAAEK,SAAS,CAAC;EAE/B,OAAOI,YAAY;AACrB","ignoreList":[]}