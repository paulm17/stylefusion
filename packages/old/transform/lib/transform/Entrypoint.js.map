{"version":3,"file":"Entrypoint.js","names":["_tsInvariant","require","_BaseEntrypoint","_Entrypoint","_EvaluatedEntrypoint","_AbortError","_BaseAction","_UnprocessedEntrypointError","EMPTY_FILE","hasLoop","name","parent","processed","console","log","includes","p","parents","found","Entrypoint","BaseEntrypoint","evaluated","onSupersedeHandlers","actionsCache","Map","hasWywMetadata","supersededWith","transformResultCode","constructor","services","initialCode","only","exports","evaluatedOnly","loadedAndParsed","resolveTasks","dependencies","generation","_parents$0$log","_parents$","loadAndParseFn","code","undefined","cache","invalidateIfChanged","evaluator","originalCode","extend","ignored","_this$supersededWith$","_this$supersededWith","transformedCode","_ref","_this$transformResult","_this$supersededWith2","createRoot","loadedCode","created","create","invariant","eventEmitter","perf","status","entrypoint","innerCreate","seqId","add","_cached$evaluatedOnly","cached","get","changed","mergedOnly","mergeOnly","filter","i","isLoop","map","push","isSuperSet","supersede","newEntrypoint","addDependency","dependency","delete","source","set","addResolveTask","assertNotSuperseded","AbortError","assertTransformed","_this$supersededWith3","UnprocessedEntrypointError","createAction","actionType","data","abortSignal","_cached$abortSignal","has","aborted","newAction","BaseAction","entrypointEvent","type","actionIdx","idx","createChild","createEvaluated","EvaluatedEntrypoint","exportsProxy","getDependency","getResolveTask","onSupersede","callback","index","indexOf","splice","setTransformResult","res","_res$code","Boolean","metadata","isNull","newOnlyOrEntrypoint","with","forEach","handler"],"sources":["../../src/transform/Entrypoint.ts"],"sourcesContent":["import { invariant } from 'ts-invariant';\n\nimport type { ParentEntrypoint, ITransformFileResult } from '../types';\n\nimport { BaseEntrypoint } from './BaseEntrypoint';\nimport { isSuperSet, mergeOnly } from './Entrypoint.helpers';\nimport type {\n  IEntrypointCode,\n  IEntrypointDependency,\n  IIgnoredEntrypoint,\n} from './Entrypoint.types';\nimport { EvaluatedEntrypoint } from './EvaluatedEntrypoint';\nimport { AbortError } from './actions/AbortError';\nimport type { ActionByType } from './actions/BaseAction';\nimport { BaseAction } from './actions/BaseAction';\nimport { UnprocessedEntrypointError } from './actions/UnprocessedEntrypointError';\nimport type { Services, ActionTypes, ActionQueueItem } from './types';\n\nconst EMPTY_FILE = '=== empty file ===';\n\nfunction hasLoop(\n  name: string,\n  parent: ParentEntrypoint,\n  processed: string[] = []\n): boolean {\n  console.log(\"Entrypoint - hasLoop\");\n  if (parent.name === name || processed.includes(parent.name)) {\n    return true;\n  }\n\n  for (const p of parent.parents) {\n    const found = hasLoop(name, p, [...processed, parent.name]);\n    if (found) {\n      return found;\n    }\n  }\n\n  return false;\n}\n\nexport class Entrypoint extends BaseEntrypoint {\n  public readonly evaluated = false;\n\n  public readonly loadedAndParsed: IEntrypointCode | IIgnoredEntrypoint;\n\n  protected onSupersedeHandlers: Array<(newEntrypoint: Entrypoint) => void> =\n    [];\n\n  private actionsCache: Map<\n    ActionTypes,\n    Map<unknown, BaseAction<ActionQueueItem>>\n  > = new Map();\n\n  #hasWywMetadata: boolean = false;\n\n  #supersededWith: Entrypoint | null = null;\n\n  #transformResultCode: string | null = null;\n\n  private constructor(\n    services: Services,\n    parents: ParentEntrypoint[],\n    public readonly initialCode: string | undefined,\n    name: string,\n    only: string[],\n    exports: Record<string | symbol, unknown> | undefined,\n    evaluatedOnly: string[],\n    loadedAndParsed?: IEntrypointCode | IIgnoredEntrypoint,\n    protected readonly resolveTasks = new Map<\n      string,\n      Promise<IEntrypointDependency>\n    >(),\n    protected readonly dependencies = new Map<string, IEntrypointDependency>(),\n    generation = 1\n  ) {\n    console.log(\"entrypoint - constructor\")\n    super(services, evaluatedOnly, exports, generation, name, only, parents);\n\n    this.loadedAndParsed =\n      loadedAndParsed ??\n      services.loadAndParseFn(\n        services,\n        name,\n        initialCode,\n        parents[0]?.log ?? services.log\n      );\n\n    if (this.loadedAndParsed.code !== undefined) {\n      services.cache.invalidateIfChanged(name, this.loadedAndParsed.code);\n    }\n\n    const code =\n      this.loadedAndParsed.evaluator === 'ignored'\n        ? '[IGNORED]'\n        : this.originalCode || EMPTY_FILE;\n\n    this.log.extend('source')('created %s (%o)\\n%s', name, only, code);\n  }\n\n  public get ignored() {\n    console.log(\"Entrypoint - get ignored\");\n    return this.loadedAndParsed.evaluator === 'ignored';\n  }\n\n  public get originalCode() {\n    console.log(\"Entrypoint - get originalCode\");\n    return this.loadedAndParsed.code;\n  }\n\n  public get supersededWith(): Entrypoint | null {\n    console.log(\"Entrypoint - get supersededWith\");\n    return this.#supersededWith?.supersededWith ?? this.#supersededWith;\n  }\n\n  public get transformedCode(): string | null {\n    console.log(\"Entrypoint - get transformedCode\");\n    return (\n      this.#transformResultCode ?? this.supersededWith?.transformedCode ?? null\n    );\n  }\n\n  public static createRoot(\n    services: Services,\n    name: string,\n    only: string[],\n    loadedCode: string | undefined\n  ): Entrypoint {\n    console.log(\"Entrypoint - createRoot\");\n    const created = Entrypoint.create(services, null, name, only, loadedCode);\n    invariant(created !== 'loop', 'loop detected');\n\n    return created;\n  }\n\n  /**\n   * Creates an entrypoint for the specified file.\n   * If there is already an entrypoint for this file, there will be four possible outcomes:\n   * 1. If `loadedCode` is specified and is different from the one that was used to create the existing entrypoint,\n   *   the existing entrypoint will be superseded by a new one and all cached results for it will be invalidated.\n   *   It can happen if the file was changed and the watcher notified us about it, or we received a new version\n   *   of the file from a loader whereas the previous one was loaded from the filesystem.\n   *   The new entrypoint will be returned.\n   * 2. If `only` is subset of the existing entrypoint's `only`, the existing entrypoint will be returned.\n   * 3. If `only` is superset of the existing entrypoint's `only`, the existing entrypoint will be superseded and the new one will be returned.\n   * 4. If a loop is detected, 'ignored' will be returned, the existing entrypoint will be superseded or not depending on the `only` value.\n   */\n  protected static create(\n    services: Services,\n    parent: ParentEntrypoint | null,\n    name: string,\n    only: string[],\n    loadedCode: string | undefined\n  ): Entrypoint | 'loop' {\n    console.log(\"Entrypoint - create\");\n    const { cache, eventEmitter } = services;\n    return eventEmitter.perf('createEntrypoint', () => {\n      const [status, entrypoint] = Entrypoint.innerCreate(\n        services,\n        parent\n          ? {\n              evaluated: parent.evaluated,\n              log: parent.log,\n              name: parent.name,\n              parents: parent.parents,\n              seqId: parent.seqId,\n            }\n          : null,\n        name,\n        only,\n        loadedCode\n      );\n\n      if (status !== 'cached') {\n        cache.add('entrypoints', name, entrypoint);\n      }\n\n      return status === 'loop' ? 'loop' : entrypoint;\n    });\n  }\n\n  private static innerCreate(\n    services: Services,\n    parent: ParentEntrypoint | null,\n    name: string,\n    only: string[],\n    loadedCode: string | undefined\n  ): ['loop' | 'created' | 'cached', Entrypoint] {\n    console.log(\"Entrypoint - innerCreate\");\n    const { cache } = services;\n\n    const cached = cache.get('entrypoints', name);\n    const changed =\n      loadedCode !== undefined\n        ? cache.invalidateIfChanged(name, loadedCode)\n        : false;\n\n    if (!cached?.evaluated && cached?.ignored) {\n      return ['cached', cached];\n    }\n\n    const exports = cached?.exports;\n    const evaluatedOnly = cached?.evaluatedOnly ?? [];\n    const mergedOnly =\n      !changed && cached?.only\n        ? mergeOnly(cached.only, only).filter((i) => !evaluatedOnly.includes(i))\n        : only;\n\n    if (cached?.evaluated) {\n      cached.log('is already evaluated with', cached.evaluatedOnly);\n    }\n\n    if (!changed && cached && !cached.evaluated) {\n      const isLoop = parent && hasLoop(name, parent);\n      if (isLoop) {\n        parent.log('[createEntrypoint] %s is a loop', name);\n      }\n\n      if (parent && !cached.parents.map((p) => p.name).includes(parent.name)) {\n        cached.parents.push(parent);\n      }\n\n      if (isSuperSet(cached.only, mergedOnly)) {\n        cached.log('is cached', name);\n        return [isLoop ? 'loop' : 'cached', cached];\n      }\n\n      cached.log(\n        'is cached, but with different `only` %o (the cached one %o)',\n        only,\n        cached?.only\n      );\n\n      return [isLoop ? 'loop' : 'created', cached.supersede(mergedOnly)];\n    }\n\n    const newEntrypoint = new Entrypoint(\n      services,\n      parent ? [parent] : [],\n      loadedCode,\n      name,\n      mergedOnly,\n      exports,\n      evaluatedOnly,\n      undefined,\n      cached && 'resolveTasks' in cached ? cached.resolveTasks : undefined,\n      cached && 'dependencies' in cached ? cached.dependencies : undefined,\n      cached ? cached.generation + 1 : 1\n    );\n\n    if (cached && !cached.evaluated) {\n      cached.log('is cached, but with different code');\n      cached.supersede(newEntrypoint);\n    }\n\n    return ['created', newEntrypoint];\n  }\n\n  public addDependency(dependency: IEntrypointDependency): void {\n    console.log(\"Entrypoint - addDependency\");\n    this.resolveTasks.delete(dependency.source);\n    this.dependencies.set(dependency.source, dependency);\n  }\n\n  public addResolveTask(\n    name: string,\n    dependency: Promise<IEntrypointDependency>\n  ): void {\n    console.log(\"Entrypoint - addResolveTask\");\n    this.resolveTasks.set(name, dependency);\n  }\n\n  public assertNotSuperseded() {\n    console.log(\"Entrypoint - assertNotSuperseded\");\n    if (this.supersededWith) {\n      this.log('superseded');\n      throw new AbortError('superseded');\n    }\n  }\n\n  public assertTransformed() {\n    console.log(\"Entrypoint - assertTransformed\");\n    if (this.transformedCode === null) {\n      this.log('not transformed');\n      throw new UnprocessedEntrypointError(this.supersededWith ?? this);\n    }\n  }\n\n  public createAction<\n    TType extends ActionTypes,\n    TAction extends ActionByType<TType>,\n  >(\n    actionType: TType,\n    data: TAction['data'],\n    abortSignal: AbortSignal | null = null\n  ): BaseAction<TAction> {\n    console.log(\"Entrypoint - createAction\");\n    if (!this.actionsCache.has(actionType)) {\n      this.actionsCache.set(actionType, new Map());\n    }\n\n    const cache = this.actionsCache.get(actionType)!;\n    const cached = cache.get(data);\n    if (cached && !cached.abortSignal?.aborted) {\n      return cached as BaseAction<TAction>;\n    }\n\n    const newAction = new BaseAction<TAction>(\n      actionType as TAction['type'],\n      this.services,\n      this,\n      data,\n      abortSignal\n    );\n\n    cache.set(data, newAction);\n\n    this.services.eventEmitter.entrypointEvent(this.seqId, {\n      type: 'actionCreated',\n      actionType,\n      actionIdx: newAction.idx,\n    });\n\n    return newAction;\n  }\n\n  public createChild(\n    name: string,\n    only: string[],\n    loadedCode?: string\n  ): Entrypoint | 'loop' {\n    console.log(\"Entrypoint - createChild\");\n    return Entrypoint.create(this.services, this, name, only, loadedCode);\n  }\n\n  public createEvaluated() {\n    console.log(\"Entrypoint - createEvaluated\");\n    const evaluatedOnly = mergeOnly(this.evaluatedOnly, this.only);\n    this.log('create EvaluatedEntrypoint for %o', evaluatedOnly);\n\n    return new EvaluatedEntrypoint(\n      this.services,\n      evaluatedOnly,\n      this.exportsProxy,\n      this.generation + 1,\n      this.name,\n      this.only,\n      this.parents\n    );\n  }\n\n  public getDependency(name: string): IEntrypointDependency | undefined {\n    console.log(\"Entrypoint - getDependency\");\n    return this.dependencies.get(name);\n  }\n\n  public getResolveTask(\n    name: string\n  ): Promise<IEntrypointDependency> | undefined {\n    console.log(\"Entrypoint - getResolveTask\");\n    return this.resolveTasks.get(name);\n  }\n\n  public hasWywMetadata() {\n    console.log(\"Entrypoint - hasWywMetadata\");\n    return this.#hasWywMetadata;\n  }\n\n  public onSupersede(callback: (newEntrypoint: Entrypoint) => void) {\n    console.log(\"Entrypoint - onSupersede\");\n    if (this.#supersededWith) {\n      callback(this.#supersededWith);\n      return () => {};\n    }\n\n    this.onSupersedeHandlers.push(callback);\n\n    return () => {\n      const index = this.onSupersedeHandlers.indexOf(callback);\n      if (index >= 0) {\n        this.onSupersedeHandlers.splice(index, 1);\n      }\n    };\n  }\n\n  public setTransformResult(res: ITransformFileResult | null) {\n    console.log(\"Entrypoint - setTransformResult\");\n    this.#hasWywMetadata = Boolean(res?.metadata);\n    this.#transformResultCode = res?.code ?? null;\n\n    this.services.eventEmitter.entrypointEvent(this.seqId, {\n      isNull: res === null,\n      type: 'setTransformResult',\n    });\n  }\n\n  private supersede(newOnlyOrEntrypoint: string[] | Entrypoint): Entrypoint {\n    console.log(\"Entrypoint - supersede\");\n    const newEntrypoint =\n      newOnlyOrEntrypoint instanceof Entrypoint\n        ? newOnlyOrEntrypoint\n        : new Entrypoint(\n            this.services,\n            this.parents,\n            this.initialCode,\n            this.name,\n            newOnlyOrEntrypoint,\n            this.exports,\n            this.evaluatedOnly,\n            this.loadedAndParsed,\n            this.resolveTasks,\n            this.dependencies,\n            this.generation + 1\n          );\n\n    this.services.eventEmitter.entrypointEvent(this.seqId, {\n      type: 'superseded',\n      with: newEntrypoint.seqId,\n    });\n    this.log(\n      'superseded by %s (%o -> %o)',\n      newEntrypoint.name,\n      this.only,\n      newEntrypoint.only\n    );\n    this.#supersededWith = newEntrypoint;\n    this.onSupersedeHandlers.forEach((handler) => handler(newEntrypoint));\n\n    return newEntrypoint;\n  }\n}\n"],"mappings":"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","ignoreList":[]}