{"version":3,"file":"createStylisPreprocessor.js","names":["path","_interopRequireWildcard","require","_stylis","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","POSIX_SEP","posix","sep","transformUrl","url","outputFilename","sourceFilename","platformPath","relative","dirname","resolve","split","join","DEFINED_KEYFRAMES","Symbol","ORIGINAL_KEYFRAME_NAME","ORIGINAL_VALUE_KEY","IS_GLOBAL_KEYFRAMES","getOriginalElementValue","element","_element$ORIGINAL_VAL","value","throwIfNotProd","key","type","process","env","NODE_ENV","Error","JSON","stringify","childrenIsString","children","propsAreStrings","props","Array","isArray","propsIsString","isDeclaration","DECLARATION","isKeyframes","KEYFRAMES","isRuleset","RULESET","stylisGlobalPlugin","getGlobalSelectorModifiers","el","parent","parentValue","length","includes","match","baseSelector","spaceDelimiter","includeBaseSelector","includeSpaceDelimiter","assign","map","cssSelector","tokens","tokenize","selector","len","token","slice","exports","createStylisUrlReplacePlugin","filename","return","replace","_match","p1","_p2","p3","p4","createKeyframeSuffixerPlugin","prefixes","getPrefixedProp","prop","prefix","buildPropsRegexp","isAtRule","at","colon","RegExp","animationNameRegexp","getReplacer","startsWith","searchValue","replacer","input","_input$match","fullMatch","undefined","rest","elementToKeyframeSuffix","replaceAll","animationPropsSet","Set","getDefinedKeyframes","keyframes","sibling","_element$siblings","siblings","add","name","_originalName$startsW","suffix","replaceFn","globalMatch","scopedMatch","originalName","isGlobal","keys","scopedKeyframes","patch","fromEntries","result","globalName","substring","isMiddleware","obj","createStylisPreprocessor","options","stylisPreprocess","text","compiled","compile","serialize","middleware","prefixer","filter"],"sources":["../../../src/transform/generators/createStylisPreprocessor.ts"],"sourcesContent":["/* eslint-disable no-continue */\nimport * as path from 'path';\nimport {\n  compile,\n  middleware,\n  prefixer,\n  serialize,\n  stringify,\n  tokenize,\n  RULESET,\n  KEYFRAMES,\n  DECLARATION,\n} from 'stylis';\nimport type { Middleware, Element } from 'stylis';\n\nimport type { Options } from '../../types';\n\nconst POSIX_SEP = path.posix.sep;\n\nexport function transformUrl(\n  url: string,\n  outputFilename: string,\n  sourceFilename: string,\n  platformPath: typeof path = path\n) {\n  // Replace asset path with new path relative to the output CSS\n  const relative = platformPath.relative(\n    platformPath.dirname(outputFilename),\n    // Get the absolute path to the asset from the path relative to the JS file\n    platformPath.resolve(platformPath.dirname(sourceFilename), url)\n  );\n\n  if (platformPath.sep === POSIX_SEP) {\n    return relative;\n  }\n\n  return relative.split(platformPath.sep).join(POSIX_SEP);\n}\n\ninterface IGlobalSelectorModifiers {\n  includeBaseSelector: boolean;\n  includeSpaceDelimiter: boolean;\n}\n\nconst DEFINED_KEYFRAMES = Symbol('definedKeyframes');\nconst ORIGINAL_KEYFRAME_NAME = Symbol('originalKeyframeName');\nconst ORIGINAL_VALUE_KEY = Symbol('originalValue');\nconst IS_GLOBAL_KEYFRAMES = Symbol('isGlobalKeyframes');\n\nconst getOriginalElementValue = (\n  element: (Element & { [ORIGINAL_VALUE_KEY]?: string }) | null\n) => {\n  return element ? element[ORIGINAL_VALUE_KEY] ?? element.value : '';\n};\n\nfunction throwIfNotProd(key: string, value: unknown, type: string): false {\n  if (process.env.NODE_ENV !== 'production') {\n    throw new Error(\n      `\"element.${key}\" has type \"${type}\" (${JSON.stringify(\n        value,\n        null,\n        2\n      )}), it's not expected. Please report a bug if it happens.`\n    );\n  }\n\n  return false;\n}\n\ntype SpecificElement<TFields> = Omit<Element, keyof TFields> & TFields;\ntype Declaration = SpecificElement<{\n  children: string;\n  props: string;\n  type: typeof DECLARATION;\n}>;\ntype Keyframes = SpecificElement<{\n  [IS_GLOBAL_KEYFRAMES]?: boolean;\n  props: string[];\n  type: typeof KEYFRAMES;\n}>;\ntype Ruleset = SpecificElement<{\n  props: string[];\n  type: typeof RULESET;\n}>;\n\nfunction childrenIsString(children: string | Element[]): children is string {\n  return (\n    typeof children === 'string' ||\n    throwIfNotProd('children', children, 'Element[]')\n  );\n}\n\nfunction propsAreStrings(props: string | string[]): props is string[] {\n  return Array.isArray(props) || throwIfNotProd('props', props, 'string');\n}\n\nfunction propsIsString(props: string | string[]): props is string {\n  return (\n    typeof props === 'string' || throwIfNotProd('props', props, 'string[]')\n  );\n}\n\nconst isDeclaration = (element: Element): element is Declaration => {\n  return (\n    element.type === DECLARATION &&\n    propsIsString(element.props) &&\n    childrenIsString(element.children)\n  );\n};\n\nconst isKeyframes = (element: Element): element is Keyframes => {\n  return element.type === KEYFRAMES && propsAreStrings(element.props);\n};\n\nconst isRuleset = (element: Element): element is Ruleset => {\n  return element.type === RULESET && propsAreStrings(element.props);\n};\n\n/**\n * Stylis plugin that mimics :global() selector behavior from Stylis v3.\n */\nexport const stylisGlobalPlugin: Middleware = (element) => {\n  function getGlobalSelectorModifiers(el: Element): IGlobalSelectorModifiers {\n    const { parent } = el;\n\n    const value = getOriginalElementValue(el);\n    const parentValue = getOriginalElementValue(parent);\n\n    if (\n      (parent?.children.length === 0 && parentValue.includes(':global(')) ||\n      (parent && !value.includes(':global('))\n    ) {\n      return getGlobalSelectorModifiers(parent);\n    }\n\n    const match = value.match(/(&\\f( )?)?:global\\(/);\n\n    if (match === null) {\n      throw new Error(\n        `Failed to match :global() selector in \"${value}\". Please report a bug if it happens.`\n      );\n    }\n\n    const [, baseSelector, spaceDelimiter] = match;\n\n    return {\n      includeBaseSelector: !!baseSelector,\n      includeSpaceDelimiter: !!spaceDelimiter,\n    };\n  }\n\n  if (!isRuleset(element)) {\n    return;\n  }\n\n  Object.assign(element, {\n    props: element.props.map((cssSelector) => {\n      // The value can be changed by other middlewares, but we need an original one with `&`\n      Object.assign(element, { [ORIGINAL_VALUE_KEY]: element.value });\n\n      // Avoids calling tokenize() on every string\n      if (!cssSelector.includes(':global(')) {\n        return cssSelector;\n      }\n\n      if (element.children.length === 0) {\n        return cssSelector;\n      }\n\n      const { includeBaseSelector, includeSpaceDelimiter } =\n        getGlobalSelectorModifiers(element);\n\n      const tokens = tokenize(cssSelector);\n      let selector = '';\n\n      for (let i = 0, len = tokens.length; i < len; i++) {\n        const token = tokens[i];\n\n        //\n        // Match for \":global(\"\n        if (token === ':' && tokens[i + 1] === 'global') {\n          //\n          // Match for \":global()\"\n          if (tokens[i + 2] === '()') {\n            selector = [\n              ...tokens.slice(i + 4),\n              includeSpaceDelimiter ? ' ' : '',\n              ...(includeBaseSelector ? tokens.slice(0, i - 1) : []),\n              includeSpaceDelimiter ? '' : ' ',\n            ].join('');\n\n            break;\n          }\n\n          //\n          // Match for \":global(selector)\"\n          selector = [\n            tokens[i + 2].slice(1, -1),\n            includeSpaceDelimiter ? ' ' : '',\n            ...(includeBaseSelector ? tokens.slice(0, i - 1) : []),\n            includeSpaceDelimiter ? '' : ' ',\n          ].join('');\n\n          break;\n        }\n      }\n\n      return selector;\n    }),\n  });\n};\n\nexport function createStylisUrlReplacePlugin(\n  filename: string,\n  outputFilename: string | undefined\n): Middleware {\n  return (element) => {\n    if (element.type === 'decl' && outputFilename) {\n      // When writing to a file, we need to adjust the relative paths inside url(..) expressions.\n      // It'll allow css-loader to resolve an imported asset properly.\n      // eslint-disable-next-line no-param-reassign\n      element.return = element.value.replace(\n        /\\b(url\\(([\"']?))(\\.[^)]+?)(\\2\\))/g,\n        (_match, p1, _p2, p3, p4) =>\n          p1 + transformUrl(p3, outputFilename, filename) + p4\n      );\n    }\n  };\n}\n\nexport function createKeyframeSuffixerPlugin(): Middleware {\n  const prefixes = ['webkit', 'moz', 'ms', 'o', ''].map((i) =>\n    i ? `-${i}-` : ''\n  );\n\n  const getPrefixedProp = (prop: string): string[] =>\n    prefixes.map((prefix) => `${prefix}${prop}`);\n\n  const buildPropsRegexp = (prop: string, isAtRule: boolean) => {\n    const [at, colon] = isAtRule ? ['@', ''] : ['', ':'];\n    return new RegExp(\n      `^(${at}(?:${getPrefixedProp(prop).join('|')})${colon})\\\\s*`\n    );\n  };\n\n  const animationNameRegexp = /:global\\(([\\w_-]+)\\)|([\\w_-]+)/;\n\n  const getReplacer = (\n    startsWith: RegExp,\n    searchValue: RegExp,\n    replacer: (substring: string, ...matches: string[]) => string\n  ): ((input: string) => string) => {\n    return (input) => {\n      const [fullMatch] = input.match(startsWith) ?? [];\n      if (fullMatch === undefined) {\n        return input;\n      }\n\n      const rest = input.slice(fullMatch.length);\n      return fullMatch + rest.replace(searchValue, replacer);\n    };\n  };\n\n  const elementToKeyframeSuffix = (el: Element): string => {\n    if (el.parent) {\n      return elementToKeyframeSuffix(el.parent);\n    }\n\n    return el.value.replaceAll(/[^a-zA-Z0-9_-]/g, '');\n  };\n\n  const animationPropsSet = new Set([\n    ...getPrefixedProp('animation'),\n    ...getPrefixedProp('animation-name'),\n  ]);\n\n  const getDefinedKeyframes = (\n    element: Element & {\n      [DEFINED_KEYFRAMES]?: Set<string>;\n      siblings?: (Element & {\n        [IS_GLOBAL_KEYFRAMES]?: boolean;\n        [ORIGINAL_KEYFRAME_NAME]?: string;\n      })[];\n    }\n  ): Set<string> => {\n    if (element[DEFINED_KEYFRAMES]) {\n      return element[DEFINED_KEYFRAMES];\n    }\n\n    if (element.parent) {\n      return getDefinedKeyframes(element.parent);\n    }\n\n    const keyframes = new Set<string>();\n    for (const sibling of element.siblings ?? []) {\n      if (sibling[ORIGINAL_KEYFRAME_NAME]) {\n        keyframes.add(sibling[ORIGINAL_KEYFRAME_NAME]);\n        continue;\n      }\n\n      const name = sibling.props[0];\n      if (\n        !isKeyframes(sibling) ||\n        sibling[IS_GLOBAL_KEYFRAMES] === true ||\n        name?.startsWith(':global(')\n      ) {\n        continue;\n      }\n\n      keyframes.add(sibling.props[0]);\n    }\n\n    Object.assign(element, { [DEFINED_KEYFRAMES]: keyframes });\n\n    return keyframes;\n  };\n\n  return (element) => {\n    if (isKeyframes(element) && element.parent) {\n      const suffix = elementToKeyframeSuffix(element);\n\n      const replaceFn = (\n        _match: string,\n        globalMatch: string,\n        scopedMatch: string\n      ): string => globalMatch || `${scopedMatch}-${suffix}`;\n\n      const originalName = element.props[0];\n      const isGlobal = originalName?.startsWith(':global(') ?? false;\n\n      Object.assign(element, {\n        [ORIGINAL_KEYFRAME_NAME]: isGlobal ? undefined : originalName,\n        [IS_GLOBAL_KEYFRAMES]: isGlobal,\n        props: element.props.map(\n          getReplacer(/^\\s*/, animationNameRegexp, replaceFn)\n        ),\n        value: getReplacer(\n          buildPropsRegexp('keyframes', true),\n          animationNameRegexp,\n          replaceFn\n        )(element.value),\n      });\n\n      return;\n    }\n\n    if (isDeclaration(element)) {\n      const suffix = elementToKeyframeSuffix(element);\n      const keys = [\n        'children',\n        'return',\n        'value',\n      ] satisfies (keyof Declaration)[];\n\n      if (animationPropsSet.has(element.props)) {\n        const scopedKeyframes = getDefinedKeyframes(element);\n        const patch = Object.fromEntries(\n          keys.map((key) => {\n            const tokens = tokenize(element[key]);\n            let result = '';\n            for (let i = 0; i < tokens.length; i += 1) {\n              if (\n                tokens[i] === ':' &&\n                tokens[i + 1] === 'global' &&\n                tokens[i + 2].startsWith('(')\n              ) {\n                const globalName = tokens[i + 2].substring(\n                  1,\n                  tokens[i + 2].length - 1\n                );\n                i += 2;\n\n                result += globalName;\n                if (tokens[i + 1] !== ';') {\n                  result += ' ';\n                }\n                continue;\n              }\n\n              if (scopedKeyframes.has(tokens[i])) {\n                result += `${tokens[i]}-${suffix}`;\n                continue;\n              }\n\n              result += tokens[i];\n            }\n\n            return [key, result];\n          })\n        );\n\n        Object.assign(element, patch);\n      }\n    }\n  };\n}\n\nconst isMiddleware = (obj: Middleware | null): obj is Middleware =>\n  obj !== null;\n\nexport function createStylisPreprocessor(\n  options: Options & { prefixer?: boolean }\n) {\n  function stylisPreprocess(selector: string, text: string): string {\n    const compiled = compile(`${selector} {${text}}\\n`);\n\n    return serialize(\n      compiled,\n      middleware(\n        [\n          createStylisUrlReplacePlugin(\n            options.filename,\n            options.outputFilename\n          ),\n          stylisGlobalPlugin,\n          options.prefixer === false ? null : prefixer,\n          createKeyframeSuffixerPlugin(),\n          stringify,\n        ].filter(isMiddleware)\n      )\n    );\n  }\n\n  return stylisPreprocess;\n}\n"],"mappings":"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","ignoreList":[]}