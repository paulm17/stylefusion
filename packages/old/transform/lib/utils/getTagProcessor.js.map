{"version":3,"file":"getTagProcessor.js","names":["_fs","require","_path","_core","_helperModuleImports","_processorUtils","_shared","_collectExportsAndImports","_collectTemplateDependencies","_getSource","_isNotNull","_scopeHelpers","_traversalCache","last","arr","length","zip","arr1","arr2","result","i","push","buildCodeFrameError","path","message","console","log","Error","definedTagsCache","Map","getDefinedTagsFromPackage","pkgName","filename","_packageJSON$wywInJ","has","get","packageJSONPath","findPackageJSON","undefined","packageDir","dirname","packageJSON","JSON","parse","readFileSync","definedTags","tags","normalizedTags","Object","entries","reduce","acc","key","value","startsWith","join","resolve","paths","set","isValidProcessorClass","module","BaseProcessor","constructor","getProcessorFromPackage","packageName","tagName","processorPath","Processor","default","getProcessorFromFile","getProcessorForImport","imported","source","options","_options$tagResolver","tagResolver","customFile","processor","getBuilderForIdentifier","definedProcessor","imports","_tagPath$parentPath","tagSource","tagPath","parentPath","isMemberExpression","property","node","params","prev","current","_current","_current2","_current3","_current4","isSequenceExpression","expressions","isCallExpression","callee","args","cookedArgs","map","arg","buildError","bind","isExpression","type","getSource","extracted","extractExpression","evaluate","filter","isNotNull","object","isIdentifier","computed","name","isStringLiteral","isTaggedTemplateExpression","tag","quasis","expressionValues","collectTemplateDependencies","replacer","replacement","isPure","mutate","p","replaceWith","addComment","importHelpers","addDefaultImport","importedSource","nameHint","addDefault","addNamedImport","addNamed","astService","Proxy","t","target","prop","receiver","Reflect","_tagPath$node$loc","loc","getDisplayName","idx","displayName","parent","findParent","isObjectProperty","isJSXOpeningElement","isVariableDeclarator","toString","keyPath","isJSXIdentifier","id","basename","test","replace","isTagReferenced","isReferenced","referencePaths","scope","getBinding","counters","WeakMap","getNextIndex","state","_counters$get","counter","getDefinedProcessors","cache","getTraversalCache","defined","forEach","local","createProcessorInstance","fileContext","_cache$get","builder","e","SKIP","applyProcessors","callback","collectExportsAndImports","explicitImport","definedProcessors","usages","idName","_path$scope$getBindin","includes","split","objBinding","identifier","sort","a","b","_a$identifier$node$st","_b$identifier$node$st","start","usage","instance"],"sources":["../../src/utils/getTagProcessor.ts"],"sourcesContent":["import { readFileSync } from 'fs';\nimport { basename, dirname, join } from 'path';\n\nimport { types as t } from '@babel/core';\nimport { addDefault, addNamed } from '@babel/helper-module-imports';\nimport type { NodePath } from '@babel/traverse';\nimport type {\n  Expression,\n  Identifier,\n  MemberExpression,\n  Program,\n  SourceLocation,\n} from '@babel/types';\n\nimport { BaseProcessor } from '@wyw-in-js/processor-utils';\nimport type {\n  Param,\n  Params,\n  IFileContext,\n  TagSource,\n} from '@wyw-in-js/processor-utils';\nimport { findPackageJSON } from '@wyw-in-js/shared';\nimport type { ExpressionValue, StrictOptions } from '@wyw-in-js/shared';\n\nimport type { IImport } from './collectExportsAndImports';\nimport {\n  collectExportsAndImports,\n  explicitImport,\n} from './collectExportsAndImports';\nimport {\n  collectTemplateDependencies,\n  extractExpression,\n} from './collectTemplateDependencies';\nimport { getSource } from './getSource';\nimport { isNotNull } from './isNotNull';\nimport { mutate } from './scopeHelpers';\nimport { getTraversalCache } from './traversalCache';\n\ntype BuilderArgs = ConstructorParameters<typeof BaseProcessor> extends [\n  Params,\n  TagSource,\n  typeof t,\n  SourceLocation | null,\n  (replacement: Expression, isPure: boolean) => void,\n  ...infer T,\n]\n  ? T\n  : never;\n\ntype Builder = (...args: BuilderArgs) => BaseProcessor;\n\ntype DefinedProcessor = [ProcessorClass, TagSource];\ntype DefinedProcessors = Map<string, DefinedProcessor>;\n\nexport type ProcessorClass = new (\n  ...args: ConstructorParameters<typeof BaseProcessor>\n) => BaseProcessor;\n\nconst last = <T>(arr: T[]): T | undefined => arr[arr.length - 1];\n\nfunction zip<T1, T2>(arr1: T1[], arr2: T2[]) {\n  const result: (T1 | T2)[] = [];\n  for (let i = 0; i < arr1.length; i++) {\n    result.push(arr1[i]);\n    if (arr2[i]) result.push(arr2[i]);\n  }\n\n  return result;\n}\n\nfunction buildCodeFrameError(path: NodePath, message: string): Error {\n  console.log(\"getTagProcessor - buildCodeFrameError\");\n  try {\n    return path.buildCodeFrameError(message);\n  } catch {\n    return new Error(message);\n  }\n}\n\nconst definedTagsCache = new Map<string, Record<string, string> | undefined>();\nconst getDefinedTagsFromPackage = (\n  pkgName: string,\n  filename: string | null | undefined\n): Record<string, string> | undefined => {\n  console.log(\"getTagProcessor - getDefinedTagsFromPackage\");\n  if (definedTagsCache.has(pkgName)) {\n    return definedTagsCache.get(pkgName);\n  }\n\n  const packageJSONPath = findPackageJSON(pkgName, filename);\n  if (!packageJSONPath) {\n    return undefined;\n  }\n\n  const packageDir = dirname(packageJSONPath);\n  const packageJSON = JSON.parse(readFileSync(packageJSONPath, 'utf8'));\n  const definedTags: Record<string, string> | undefined =\n    packageJSON['wyw-in-js']?.tags;\n\n  const normalizedTags = definedTags\n    ? Object.entries(definedTags).reduce(\n        (acc, [key, value]) => ({\n          ...acc,\n          [key]: value.startsWith('.')\n            ? join(packageDir, value)\n            : require.resolve(value, { paths: [packageDir] }),\n        }),\n        {} as Record<string, string>\n      )\n    : undefined;\n\n  definedTagsCache.set(pkgName, normalizedTags);\n\n  return normalizedTags;\n};\n\nfunction isValidProcessorClass(module: unknown): module is ProcessorClass {\n  console.log(\"getTagProcessor - isValidProcessorClass\");\n  return module instanceof BaseProcessor.constructor;\n}\n\nfunction getProcessorFromPackage(\n  packageName: string,\n  tagName: string,\n  filename: string | null | undefined\n): ProcessorClass | null {\n  console.log(\"getTagProcessor - getProcessorFromPackage\");\n  const definedTags = getDefinedTagsFromPackage(packageName, filename);\n  const processorPath = definedTags?.[tagName];\n  if (!processorPath) {\n    return null;\n  }\n\n  const Processor = require(processorPath).default;\n  if (!isValidProcessorClass(Processor)) {\n    return null;\n  }\n\n  return Processor;\n}\n\nfunction getProcessorFromFile(processorPath: string): ProcessorClass | null {\n  console.log(\"getTagProcessor - getProcessorFromFile\");\n  const Processor = require(processorPath).default;\n  if (!isValidProcessorClass(Processor)) {\n    return null;\n  }\n\n  return Processor;\n}\n\nexport function getProcessorForImport(\n  { imported, source }: IImport,\n  filename: string | null | undefined,\n  options: Pick<StrictOptions, 'tagResolver'>\n): [ProcessorClass | null, TagSource] {\n  console.log(\"getTagProcessor - getProcessorForImport\");\n  const tagResolver = options.tagResolver ?? (() => null);\n\n  const customFile = tagResolver(source, imported);\n  const processor = customFile\n    ? getProcessorFromFile(customFile)\n    : getProcessorFromPackage(source, imported, filename);\n  return [processor, { imported, source }];\n}\n\nfunction getBuilderForIdentifier(\n  definedProcessor: DefinedProcessor,\n  path: NodePath<Identifier>,\n  imports: IImport[],\n  options: Pick<StrictOptions, 'evaluate'>\n): Builder | null {\n  console.log(\"getTagProcessor - getBuilderForIdentifier\");\n  const [Processor, tagSource] = definedProcessor;\n  let tagPath: NodePath<Identifier | MemberExpression> = path;\n  if (tagPath.parentPath?.isMemberExpression({ property: tagPath.node })) {\n    tagPath = tagPath.parentPath;\n  }\n\n  if (!Processor || !tagSource || !tagPath) {\n    return null;\n  }\n\n  const params: Param[] = [['callee', tagPath.node]];\n  let prev: NodePath = tagPath;\n  let current: NodePath | null = tagPath.parentPath;\n  while (current && current !== path) {\n    if (\n      current?.isSequenceExpression() &&\n      last(current.node.expressions) === prev.node\n    ) {\n      prev = current;\n      current = current.parentPath;\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    if (current?.isCallExpression({ callee: prev.node })) {\n      const args = current.get('arguments');\n      const cookedArgs = args\n        .map((arg) => {\n          const buildError = arg.buildCodeFrameError.bind(arg);\n          if (!arg.isExpression()) {\n            throw buildError(`Unexpected type of an argument ${arg.type}`);\n          }\n          const source = getSource(arg);\n          const extracted = extractExpression(arg, options.evaluate, imports);\n          return {\n            ...extracted,\n            source,\n            buildCodeFrameError: buildError,\n          } as ExpressionValue;\n        })\n        .filter(isNotNull);\n\n      params.push(['call', ...cookedArgs]);\n      prev = current;\n      current = current.parentPath;\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    if (current?.isMemberExpression({ object: prev.node })) {\n      const property = current.get('property');\n      if (property.isIdentifier() && !current.node.computed) {\n        params.push(['member', property.node.name]);\n      } else if (property.isStringLiteral()) {\n        params.push(['member', property.node.value]);\n      } else {\n        throw property.buildCodeFrameError(`Unexpected type of a property`);\n      }\n\n      prev = current;\n      current = current.parentPath;\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    if (current?.isTaggedTemplateExpression({ tag: prev.node })) {\n      const [quasis, expressionValues] = collectTemplateDependencies(\n        current,\n        options.evaluate\n      );\n      params.push(['template', zip(quasis, expressionValues)]);\n\n      prev = current;\n      current = current.parentPath;\n      // eslint-disable-next-line no-continue\n      continue;\n    }\n\n    break;\n  }\n\n  const replacer = (replacement: Expression, isPure: boolean) => {\n    mutate(prev, (p) => {\n      p.replaceWith(replacement);\n      if (isPure) {\n        p.addComment('leading', '#__PURE__');\n      }\n    });\n  };\n\n  const importHelpers = {\n    addDefaultImport: (importedSource: string, nameHint?: string) =>\n      addDefault(path, importedSource, { nameHint }),\n    addNamedImport: (\n      name: string,\n      importedSource: string,\n      nameHint: string = name\n    ) => addNamed(path, name, importedSource, { nameHint }),\n  };\n\n  type AstService = typeof t & typeof importHelpers;\n\n  const astService = new Proxy<AstService>(t as AstService, {\n    get(target, prop, receiver) {\n      if (prop in importHelpers) {\n        return importHelpers[prop as keyof typeof importHelpers];\n      }\n\n      return Reflect.get(target, prop, receiver);\n    },\n  });\n\n  return (...args: BuilderArgs) =>\n    new Processor(\n      params,\n      tagSource,\n      astService,\n      tagPath.node.loc ?? null,\n      replacer,\n      ...args\n    );\n}\n\nfunction getDisplayName(\n  path: NodePath<Identifier>,\n  idx: number,\n  filename?: string | null\n): string {\n  console.log(\"getTagProcessor - getDisplayName\");\n  let displayName: string | undefined;\n\n  const parent = path.findParent(\n    (p) =>\n      p.isObjectProperty() ||\n      p.isJSXOpeningElement() ||\n      p.isVariableDeclarator()\n  );\n\n  if (parent) {\n    if (parent.isObjectProperty()) {\n      if ('name' in parent.node.key) {\n        displayName = parent.node.key.name;\n      } else if ('value' in parent.node.key) {\n        displayName = parent.node.key.value.toString();\n      } else {\n        const keyPath = parent.get('key');\n        displayName = getSource(keyPath);\n      }\n    } else if (parent.isJSXOpeningElement()) {\n      const name = parent.get('name');\n      if (name.isJSXIdentifier()) {\n        displayName = name.node.name;\n      }\n    } else if (parent.isVariableDeclarator()) {\n      const id = parent.get('id');\n      if (id.isIdentifier()) {\n        displayName = id.node.name;\n      }\n    }\n  }\n\n  if (!displayName) {\n    // Try to derive the path from the filename\n    displayName = basename(filename ?? 'unknown');\n\n    if (filename && /^index\\.[a-z\\d]+$/.test(displayName)) {\n      // If the file name is 'index', better to get name from parent folder\n      displayName = basename(dirname(filename));\n    }\n\n    // Remove the file extension\n    displayName = displayName.replace(/\\.[a-z\\d]+$/, '');\n\n    if (displayName) {\n      displayName += idx;\n    } else {\n      throw new Error(\n        \"Couldn't determine a name for the component. Ensure that it's either:\\n\" +\n          '- Assigned to a variable\\n' +\n          '- Is an object property\\n' +\n          '- Is a prop in a JSX element\\n'\n      );\n    }\n  }\n\n  return displayName;\n}\n\nfunction isTagReferenced(path: NodePath): boolean {\n  console.log(\"getTagProcessor - isTagReferenced\");\n  // Check if the variable is referenced anywhere for basic DCE\n  // Only works when it's assigned to a variable\n  let isReferenced = true;\n\n  const parent = path.findParent(\n    (p) =>\n      p.isObjectProperty() ||\n      p.isJSXOpeningElement() ||\n      p.isVariableDeclarator()\n  );\n\n  if (parent) {\n    if (parent.isVariableDeclarator()) {\n      const id = parent.get('id');\n      // FIXME: replace with id.isReferencedIdentifier()\n      if (id.isIdentifier()) {\n        const { referencePaths } = path.scope.getBinding(id.node.name) || {\n          referencePaths: [],\n        };\n\n        isReferenced = referencePaths.length !== 0;\n      }\n    }\n  }\n\n  return isReferenced;\n}\n\nconst counters = new WeakMap<IFileContext, number>();\nconst getNextIndex = (state: IFileContext) => {\n  const counter = counters.get(state) ?? 0;\n  counters.set(state, counter + 1);\n  return counter;\n};\n\nexport function getDefinedProcessors(\n  imports: IImport[],\n  path: NodePath<Program>,\n  filename: string | null | undefined,\n  options: Pick<StrictOptions, 'tagResolver'>\n): DefinedProcessors {\n  console.log(\"getTagProcessor - getDefinedProcessors\");\n  const cache = getTraversalCache<DefinedProcessors, NodePath<Program>>(\n    path,\n    'getDefinedProcessors'\n  );\n\n  if (!cache.has(path)) {\n    const defined: DefinedProcessors = new Map();\n\n    imports.forEach((i) => {\n      const [processor, tagSource] = getProcessorForImport(\n        i,\n        filename,\n        options\n      );\n      const { local } = i;\n      if (!processor) {\n        return;\n      }\n\n      let name: string | null = null;\n      if (local.isIdentifier()) {\n        name = local.node.name;\n      }\n\n      if (name === null && local.isMemberExpression()) {\n        const property = local.get('property');\n        const object = local.get('object');\n        if (property.isIdentifier() && object.isIdentifier()) {\n          name = `${object.node.name}.${property.node.name}`;\n        }\n      }\n\n      if (name === null) {\n        return;\n      }\n\n      defined.set(name, [processor, tagSource]);\n    });\n\n    cache.set(path, defined);\n  }\n\n  return cache.get(path)!;\n}\n\nfunction createProcessorInstance(\n  definedProcessor: [ProcessorClass, TagSource],\n  imports: IImport[],\n  path: NodePath<Identifier>,\n  fileContext: IFileContext,\n  options: Pick<\n    StrictOptions,\n    'classNameSlug' | 'displayName' | 'evaluate' | 'tagResolver'\n  >\n): BaseProcessor | null {\n  console.log(\"getTagProcessor - createProcessorInstance\");\n  const cache = getTraversalCache<BaseProcessor | null, Identifier>(\n    path,\n    'createProcessorInstance'\n  );\n\n  if (!cache.has(path.node)) {\n    try {\n      const builder = getBuilderForIdentifier(\n        definedProcessor,\n        path,\n        imports,\n        options\n      );\n      if (builder) {\n        // Increment the index of the style we're processing\n        // This is used for slug generation to prevent collision\n        // Also used for display name if it couldn't be determined\n        const idx = getNextIndex(fileContext);\n\n        const displayName = getDisplayName(path, idx, fileContext.filename);\n\n        const processor = builder(\n          displayName,\n          isTagReferenced(path),\n          idx,\n          options,\n          fileContext\n        );\n\n        cache.set(path.node, processor);\n      } else {\n        cache.set(path.node, null);\n      }\n    } catch (e) {\n      if (e === BaseProcessor.SKIP) {\n        cache.set(path.node, null);\n        return null;\n      }\n\n      if (e instanceof Error) {\n        throw buildCodeFrameError(path, e.message);\n      }\n\n      throw e;\n    }\n  }\n\n  return cache.get(path.node) ?? null;\n}\n\nexport function applyProcessors(\n  path: NodePath<Program>,\n  fileContext: IFileContext,\n  options: Pick<\n    StrictOptions,\n    'classNameSlug' | 'displayName' | 'evaluate' | 'tagResolver'\n  >,\n  callback: (processor: BaseProcessor) => void\n) {\n  console.log(\"getTagProcessor - applyProcessors\");\n  const imports = collectExportsAndImports(path).imports.filter(explicitImport);\n\n  const definedProcessors = getDefinedProcessors(\n    imports,\n    path,\n    fileContext.filename,\n    options\n  );\n\n  const usages: {\n    identifier: NodePath<Identifier>;\n    processor: DefinedProcessor;\n  }[] = [];\n\n  definedProcessors.forEach((processor, idName) => {\n    if (idName.includes('.')) {\n      // It's a member expression\n      const [object, property] = idName.split('.');\n      const objBinding = path.scope.getBinding(object);\n      if (!objBinding) {\n        return;\n      }\n\n      objBinding.referencePaths.forEach((p) => {\n        const parent = p.parentPath;\n        if (!parent?.isMemberExpression()) {\n          return;\n        }\n\n        const identifier = parent.get('property');\n        if (identifier.isIdentifier({ name: property })) {\n          usages.push({\n            identifier,\n            processor,\n          });\n        }\n      });\n\n      return;\n    }\n\n    path.scope.getBinding(idName)?.referencePaths.forEach((identifier) => {\n      if (identifier.isIdentifier()) {\n        usages.push({\n          identifier,\n          processor,\n        });\n      }\n    });\n  });\n\n  // The same order, the same slugs\n  usages.sort(\n    (a, b) => (a.identifier.node.start ?? 0) - (b.identifier.node.start ?? 0)\n  );\n\n  usages.forEach((usage) => {\n    const definedProcessor = usage.processor;\n\n    if (!definedProcessor) {\n      return;\n    }\n\n    const instance = createProcessorInstance(\n      definedProcessor,\n      imports,\n      usage.identifier,\n      fileContext,\n      options\n    );\n\n    if (instance === null) {\n      return;\n    }\n\n    callback(instance);\n  });\n}\n"],"mappings":"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","ignoreList":[]}