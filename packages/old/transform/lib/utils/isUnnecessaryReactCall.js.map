{"version":3,"file":"isUnnecessaryReactCall.js","names":["_collectExportsAndImports","require","_getScope","getCallee","p","console","log","callee","get","isSequenceExpression","expressions","length","isNumericLiteral","value","JSXRuntimeSource","isJSXRuntime","imports","_jsxRuntime$local","_jsxRuntime$local2","jsxRuntime","find","i","source","jsxRuntimeName","local","isIdentifier","node","name","isMemberExpression","isHookOrCreateElement","test","isClassicReactRuntime","reactImports","filter","imported","_getScope$getBinding","bindingPath","getScope","getBinding","path","some","isAncestor","_getScope$getBinding2","_bindingPath$isAncest","object","property","defaultImport","isUnnecessaryReactCall","programPath","findParent","isProgram","collectExportsAndImports"],"sources":["../../src/utils/isUnnecessaryReactCall.ts"],"sourcesContent":["import type { NodePath } from '@babel/core';\nimport type { CallExpression, Program } from '@babel/types';\n\nimport type { IImport, ISideEffectImport } from './collectExportsAndImports';\nimport { collectExportsAndImports } from './collectExportsAndImports';\nimport { getScope } from './getScope';\n\nfunction getCallee(p: NodePath<CallExpression>) {\n  console.log(\"isUnnecessaryReactCall - getCallee\");\n  const callee = p.get('callee');\n  if (callee.isSequenceExpression()) {\n    const expressions = callee.get('expressions');\n    if (\n      expressions.length === 2 &&\n      expressions[0].isNumericLiteral({ value: 0 })\n    ) {\n      return expressions[1];\n    }\n\n    return callee;\n  }\n\n  return callee;\n}\n\nconst JSXRuntimeSource = 'react/jsx-runtime';\n\nfunction isJSXRuntime(\n  p: NodePath<CallExpression>,\n  imports: (IImport | ISideEffectImport)[]\n) {\n  const jsxRuntime = imports.find((i) => i.source === JSXRuntimeSource);\n  const jsxRuntimeName =\n    jsxRuntime?.local?.isIdentifier() && jsxRuntime?.local?.node?.name;\n\n  if (jsxRuntime) {\n    const callee = getCallee(p);\n    if (jsxRuntimeName && callee.isIdentifier({ name: jsxRuntimeName })) {\n      return true;\n    }\n\n    if (\n      callee.isMemberExpression() &&\n      imports.find((i) => i.source === JSXRuntimeSource && i.local === callee)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction isHookOrCreateElement(name: string): boolean {\n  console.log(\"isUnnecessaryReactCall - isHookOrCreateElement\");\n  return name === 'createElement' || /use[A-Z]/.test(name);\n}\n\nfunction isClassicReactRuntime(\n  p: NodePath<CallExpression>,\n  imports: (IImport | ISideEffectImport)[]\n) {\n  console.log(\"isUnnecessaryReactCall - isClassicReactRuntime\");\n  const reactImports = imports.filter(\n    (i) =>\n      i.source === 'react' &&\n      (i.imported === 'default' ||\n        (i.imported && isHookOrCreateElement(i.imported)))\n  ) as IImport[];\n\n  if (reactImports.length === 0) return false;\n  const callee = getCallee(p);\n  if (callee.isIdentifier() && isHookOrCreateElement(callee.node.name)) {\n    const bindingPath = getScope(callee).getBinding(callee.node.name)?.path;\n    return reactImports.some((i) => bindingPath?.isAncestor(i.local));\n  }\n\n  if (callee.isMemberExpression()) {\n    if (reactImports.some((i) => i.local === callee)) {\n      // It's React.createElement in CJS\n      return true;\n    }\n\n    const object = callee.get('object');\n    const property = callee.get('property');\n    const defaultImport = reactImports.find((i) => i.imported === 'default');\n    if (\n      !defaultImport ||\n      !defaultImport.local.isIdentifier() ||\n      !property.isIdentifier() ||\n      !isHookOrCreateElement(property.node.name) ||\n      !object.isIdentifier({ name: defaultImport.local.node.name })\n    ) {\n      return false;\n    }\n\n    const bindingPath = getScope(object).getBinding(object.node.name)?.path;\n    return bindingPath?.isAncestor(defaultImport.local) ?? false;\n  }\n\n  return false;\n}\n\nexport function isUnnecessaryReactCall(path: NodePath<CallExpression>) {\n  console.log(\"isUnnecessaryReactCall - isUnnecessaryReactCall\");\n  const programPath = path.findParent((p) => p.isProgram()) as\n    | NodePath<Program>\n    | undefined;\n  if (!programPath) {\n    return false;\n  }\n\n  const { imports } = collectExportsAndImports(programPath);\n\n  return isJSXRuntime(path, imports) || isClassicReactRuntime(path, imports);\n}\n"],"mappings":"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","ignoreList":[]}