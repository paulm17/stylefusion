{"version":3,"file":"findIdentifiers.js","names":["_getScope","require","isInUnary","path","_path$parentPath$isUn","_path$parentPath","console","log","parentPath","isUnaryExpression","isInDelete","node","operator","isBindingIdentifier","isReferencedIdentifier","checkers","any","ex","binding","declaration","_ex$scope$getBinding","scope","getBinding","name","identifier","reference","nonType","find","p","isTSTypeReference","isTSTypeQuery","isFlowType","isFlowDeclaration","isTSInterfaceDeclaration","findIdentifiers","expressions","type","identifiers","forEach","emit","removed","getScope","isAncestor","push","isIdentifier","isJSXIdentifier","traverse","Identifier","JSXIdentifier"],"sources":["../../src/utils/findIdentifiers.ts"],"sourcesContent":["import type { NodePath } from '@babel/traverse';\nimport type {\n  Node,\n  Identifier,\n  JSXIdentifier,\n  UnaryExpression,\n} from '@babel/types';\n\nimport { getScope } from './getScope';\n\ntype FindType = 'any' | 'binding' | 'declaration' | 'reference';\n\nfunction isInUnary<T extends NodePath>(\n  path: T\n): path is T & { parentPath: NodePath<UnaryExpression> } {\n  console.log(\"findIdentifiers - isInUnary\");\n  return path.parentPath?.isUnaryExpression() ?? false;\n}\n\n// It's possible for non-strict mode code to have variable deletions.\nfunction isInDelete(path: { parentPath: NodePath<UnaryExpression> }): boolean {\n  console.log(\"findIdentifiers - isInDelete\");\n  return path.parentPath.node.operator === 'delete';\n}\n\nfunction isBindingIdentifier(path: NodePath): path is NodePath<Identifier> {\n  console.log(\"findIdentifiers - isBindingIdentifier\");\n  return path.isBindingIdentifier() && (!isInUnary(path) || isInDelete(path));\n}\n\nfunction isReferencedIdentifier(\n  path: NodePath\n): path is NodePath<Identifier | JSXIdentifier> {\n  console.log(\"findIdentifiers - isReferencedIdentifier\");\n  return (\n    path.isReferencedIdentifier() || (isInUnary(path) && !isInDelete(path))\n  );\n}\n\n// For some reasons, `isBindingIdentifier` returns true for identifiers inside unary expressions.\nconst checkers: Record<\n  FindType,\n  (ex: NodePath<Identifier | JSXIdentifier>) => boolean\n> = {\n  any: (ex) => isBindingIdentifier(ex) || isReferencedIdentifier(ex),\n  binding: (ex) => isBindingIdentifier(ex),\n  declaration: (ex) =>\n    isBindingIdentifier(ex) &&\n    ex.scope.getBinding(ex.node.name)?.identifier === ex.node,\n  reference: (ex) => isReferencedIdentifier(ex),\n};\n\nexport function nonType(path: NodePath): boolean {\n  console.log(\"findIdentifiers - nonType\");\n  return !path.find(\n    (p) =>\n      p.isTSTypeReference() ||\n      p.isTSTypeQuery() ||\n      p.isFlowType() ||\n      p.isFlowDeclaration() ||\n      p.isTSInterfaceDeclaration()\n  );\n}\n\nexport function findIdentifiers(\n  expressions: NodePath<Node | null | undefined>[],\n  type: FindType = 'reference'\n): NodePath<Identifier | JSXIdentifier>[] {\n  console.log(\"findIdentifiers - findIdentifiers\");\n  const identifiers: NodePath<Identifier | JSXIdentifier>[] = [];\n\n  expressions.forEach((ex) => {\n    const emit = (path: NodePath<Identifier | JSXIdentifier>) => {\n      if (!path.node || path.removed || !checkers[type](path)) {\n        return;\n      }\n\n      // TODO: Is there a better way to check that it's a local variable?\n\n      const binding = getScope(path).getBinding(path.node.name);\n      if (!binding) {\n        return;\n      }\n\n      if (type === 'reference' && ex.isAncestor(binding.path)) {\n        // This identifier is declared inside the expression. We don't need it.\n        return;\n      }\n\n      identifiers.push(path);\n    };\n\n    if (ex.isIdentifier() || ex.isJSXIdentifier()) {\n      emit(ex);\n    } else {\n      ex.traverse({\n        Identifier(path: NodePath<Identifier>) {\n          emit(path);\n        },\n        JSXIdentifier(path: NodePath<JSXIdentifier>) {\n          emit(path);\n        },\n      });\n    }\n  });\n\n  return identifiers;\n}\n"],"mappings":"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","ignoreList":[]}